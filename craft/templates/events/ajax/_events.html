{% set currentMonth = month ? month : "now"|date('n') %}
{% set currentYear = year ? year : "now"|date('Y') %}

{% set current = currentYear  ~ "-" ~ currentMonth ~ "-1" %}

{% set prevMonth = current|date_modify("last day of last month")|date('U') %}
{% set nextMonth = current|date_modify("first day of next month")|date('U') %}

{% set groupIds = craft.request.getSegment(5) and craft.request.getSegment(5) != "*" ? craft.request.getSegment(5) : [] %}

{#  Get Events for month between prevMonth & nextMonth #}
{% set events = craft.venti.events().groupId(groupIds).between(prevMonth,nextMonth) %}

{# {% include 'events/components/_eventsNav' with { prev:prevMonth, next:nextMonth, current:current, ids:groupIds } only %} #}

{% cache  %}
<div class="timeline" data-month="{{ month }}" data-year="{{ year }}">
    {# Group events by day of the month using the event's startDate as a guide #}
    {% for day, dayEvents in events|group('startDate|date("M d Y")')  %}

    {# Feature Event Article #}
    <article class="featured-event inf-card    border-b border-grey-lightest  py-8 mb-6 ">

        <div class="featured-event__content sm:flex sm:justify-between">

            <time class="featured-event__date sm:border-r sm:border-grey-lightest mb-2 block md:pr-12 sm:pr-8 sm:mb-0 text-blue">
                <span class="text-md sm:text-lg sm:block">{{ day|date('M') }}</span>
                <span class="text-md sm:text-lg lg:text-4xl sm:block">{{ day|date('d') }}</span>
            </time>
            

            <div class="featured-event__content sm:flex-1 sm:pl-6 md:pl-8">
                {% for event in dayEvents %}
                    <a class="no-underline hover:text-green mt-8 md:mt-12" href="{{ event.url }}">
                        <h4 class="text-2md sm:text-lg mb-8 md:mb-12">{{ event.title }}</h4>
                    </a>
                    
                    <div class="featured-event__info   block text-grey-dark">
                        {# Info #}
                        <div class="flex sm:mb-2">
                            <span class="icon --map --sm mr-3 top-2 relative tr-all">
                                <svg><use xlink:href="/assets/svg/symbols.svg#map"></use></svg>
                            </span>
                            <a class="text-xs mb-3 block no-underline text-grey-dark hover:text-blue" target="_blank" href="{{event.location[0].getMapUrl()}}">{{event.location[0]}}</a>
                        </div>
                        
                        {# Info #}
                        <div class="flex sm:mb-2">
                            <span class="icon --map --sm mr-3 top-2 relative tr-all">
                                <svg><use xlink:href="/assets/svg/symbols.svg#calendar"></use></svg>
                            </span>
                            
                            <div class="text-xs mb-3 block leading-normal">
                                <p>{{ event.startDate|date('M') }} {{ event.startDate|date('d') }}, {{ event.startDate|date('Y') }}</p>
                                {% if event.allDay %}
                                    All Day
                                {% else %}
                                    <p>{{ event.startDate|date("g:i a") }} - {{ event.endDate|date("g:i a") }}</p>
                                {% endif %}

                            </div> 
                        </div>

                    </div>

                    <div class="text-right">
                        {% if event.registration|length %}
                            {# Show button to register if available #}
                            <a href="{{event.registration.url}}" target="_blank" class="btn --auto-w text-xs">Register</a>
                        {% else %}
                            {# Show Type if no Registration: 
                               Show description if available, else show name #}
                            <span style="color:{{ event.getColor() }}" class="text-xs">
                                {% if event.getGroup.description|length %}
                                    {{event.getGroup.description|striptags("p")}}
                                {% else %}
                                    {{event.getGroup}}
                                {% endif %} 
                            </span>
                        {% endif %}
                    </div>


                {% endfor %}

            </div>

        </div>
        
        

    </article>

        

    {% endfor %}
</div>

{% endcache %}
